import{__awaiter,__generator}from"tslib";import{r as registerInstance,f as readTask,c as writeTask,j as forceUpdate,h,H as Host,i as getElement}from"./index-70672e81.js";import{c as componentOnReady}from"./helpers-6b411283.js";var CELL_TYPE_ITEM="item";var CELL_TYPE_HEADER="header";var CELL_TYPE_FOOTER="footer";var NODE_CHANGE_NONE=0;var NODE_CHANGE_POSITION=1;var NODE_CHANGE_CELL=2;var MIN_READS=2;var updateVDom=function(e,t,i,r){for(var n=0,s=e;n<s.length;n++){var a=s[n];a.change=NODE_CHANGE_NONE;a.d=true}var o=[];var l=r.offset+r.length;var p=function(r){var n=i[r];var s=e.find((function(e){return e.d&&e.cell===n}));if(s){var a=t[r];if(a!==s.top){s.top=a;s.change=NODE_CHANGE_POSITION}s.d=false}else{o.push(n)}};for(var d=r.offset;d<l;d++){p(d)}var h=e.filter((function(e){return e.d}));var c=function(i){var r=h.find((function(e){return e.d&&e.cell.type===i.type}));var n=i.i;if(r){r.d=false;r.change=NODE_CHANGE_CELL;r.cell=i;r.top=t[n]}else{e.push({d:false,cell:i,visible:true,change:NODE_CHANGE_CELL,top:t[n]})}};for(var x=0,m=o;x<m.length;x++){var u=m[x];c(u)}e.filter((function(e){return e.d&&e.top!==-9999})).forEach((function(e){e.change=NODE_CHANGE_POSITION;e.top=-9999}))};var doRender=function(e,t,i,r){var n=Array.from(e.children).filter((function(e){return e.tagName!=="TEMPLATE"}));var s=n.length;var a;for(var o=0;o<i.length;o++){var l=i[o];var p=l.cell;if(l.change===NODE_CHANGE_CELL){if(o<s){a=n[o];t(a,p,o)}else{var d=createNode(e,p.type);a=t(d,p,o)||d;a.classList.add("virtual-item");e.appendChild(a)}a["$ionCell"]=p}else{a=n[o]}if(l.change!==NODE_CHANGE_NONE){a.style.transform="translate3d(0,"+l.top+"px,0)"}var h=p.visible;if(l.visible!==h){if(h){a.classList.remove("virtual-loading")}else{a.classList.add("virtual-loading")}l.visible=h}if(p.reads>0){r(p,a);p.reads--}}};var createNode=function(e,t){var i=getTemplate(e,t);if(i&&e.ownerDocument){return e.ownerDocument.importNode(i.content,true).children[0]}return null};var getTemplate=function(e,t){switch(t){case CELL_TYPE_ITEM:return e.querySelector("template:not([name])");case CELL_TYPE_HEADER:return e.querySelector("template[name=header]");case CELL_TYPE_FOOTER:return e.querySelector("template[name=footer]")}};var getViewport=function(e,t,i){return{top:Math.max(e-i,0),bottom:e+t+i}};var getRange=function(e,t,i){var r=t.top;var n=t.bottom;var s=0;for(;s<e.length;s++){if(e[s]>r){break}}var a=Math.max(s-i-1,0);for(;s<e.length;s++){if(e[s]>=n){break}}var o=Math.min(s+i,e.length);var l=o-a;return{offset:a,length:l}};var getShouldUpdate=function(e,t,i){var r=i.offset+i.length;return e<=r||t.offset!==i.offset||t.length!==i.length};var findCellIndex=function(e,t){var i=e.length>0?e[e.length-1].index:0;if(t===0){return 0}else if(t===i+1){return e.length}else{return e.findIndex((function(e){return e.index===t}))}};var inplaceUpdate=function(e,t,i){if(i===0&&t.length>=e.length){return t}for(var r=0;r<t.length;r++){e[r+i]=t[r]}return e};var calcCells=function(e,t,i,r,n,s,a,o,l,p,d,h){var c=[];var x=h+d;for(var m=d;m<x;m++){var u=e[m];if(n){var g=n(u,m,e);if(g!=null){c.push({i:p++,type:CELL_TYPE_HEADER,value:g,index:m,height:i?i(g,m):a,reads:i?0:MIN_READS,visible:!!i})}}c.push({i:p++,type:CELL_TYPE_ITEM,value:u,index:m,height:t?t(u,m):l,reads:t?0:MIN_READS,visible:!!t});if(s){var g=s(u,m,e);if(g!=null){c.push({i:p++,type:CELL_TYPE_FOOTER,value:g,index:m,height:r?r(g,m):o,reads:r?0:MIN_READS,visible:!!r})}}}return c};var calcHeightIndex=function(e,t,i){var r=e[i];for(var n=i;n<e.length;n++){e[n]=r;r+=t[n].height}return r};var resizeBuffer=function(e,t){if(!e){return new Uint32Array(t)}if(e.length===t){return e}else if(t>e.length){var i=new Uint32Array(t);i.set(e);return i}else{return e.subarray(0,t)}};var positionForIndex=function(e,t,i){var r=t.find((function(t){return t.type===CELL_TYPE_ITEM&&t.index===e}));if(r){return i[r.i]}return-1};var virtualScrollCss=':root{--med-font-family-brand:"fsemeric";--med-font-family-base:"fsemeric";--med-font-size-nano:10px;--med-font-size-xxxs:12px;--med-font-size-xxs:14px;--med-font-size-xs:16px;--med-font-size-sm:20px;--med-font-size-md:24px;--med-font-size-lg:32px;--med-font-size-xl:40px;--med-font-size-xxl:48px;--med-font-size-xxxl:64px;--med-font-size-huge:96px;--med-font-weight-thin:250;--med-font-weight-light:300;--med-font-weight-regular:400;--med-font-weight-medium:500;--med-font-weight-semibold:600;--med-font-weight-bold:700;--med-font-weight-extrabold:800;--med-font-weight-heavy:900;--med-letter-spacing-ultracompressed:-0.04;--med-letter-spacing-compressed:-0.02;--med-letter-spacing-default:0;--med-letter-spacing-medium:0.02;--med-letter-spacing-expanded:0.05;--med-letter-spacing-distant:0.1;--med-letter-spacing-far:0.2;--med-line-height-compressed:100%;--med-line-height-default:24px;--med-line-height-double:200%}:root{--med-spacing-inset-nano:4px;--med-spacing-inset-xs:8px;--med-spacing-inset-sm:16px;--med-spacing-inset-base:24px;--med-spacing-inset-md:32px;--med-spacing-inset-lg:40px;--med-spacing-inset-xl:48px;--med-spacing-inset-xxl:64px;--med-spacing-squish-nano:4px 8px;--med-spacing-squish-xs:8px 16px;--med-spacing-squish-sm:8px 24px;--med-spacing-squish-base:8px 32px;--med-spacing-squish-md:16px 24px;--med-spacing-squish-lg:16px 32px;--med-spacing-squish-xl:24px 32px;--med-spacing-squish-xxl:32px 40px;--med-spacing-stretch-nano:8px 4px;--med-spacing-stretch-xs:16px 8px;--med-spacing-stretch-sm:24px 8px;--med-spacing-stretch-base:32px 8px;--med-spacing-stretch-md:24px 16px;--med-spacing-stretch-lg:32px 16px;--med-spacing-stretch-xl:32px 24px;--med-spacing-stretch-xxl:40px 32px;--med-spacing-inline-quark:2px;--med-spacing-inline-nano:4px;--med-spacing-inline-xxxs:8px;--med-spacing-inline-base:16px;--med-spacing-inline-xxs:24px;--med-spacing-inline-xs:32px;--med-spacing-inline-sm:40px;--med-spacing-inline-md:48px;--med-spacing-inline-lg:56px;--med-spacing-inline-xl:64px;--med-spacing-inline-xxl:72px;--med-spacing-inline-xxxl:80px;--med-spacing-inline-huge:120px;--med-spacing-inline-ultra:160px;--med-spacing-stack-quark:2px;--med-spacing-stack-nano:4px;--med-spacing-stack-xxxs:8px;--med-spacing-stack-base:16px;--med-spacing-stack-xxs:24px;--med-spacing-stack-xs:32px;--med-spacing-stack-sm:40px;--med-spacing-stack-md:48px;--med-spacing-stack-lg:56px;--med-spacing-stack-xl:64px;--med-spacing-stack-xxl:72px;--med-spacing-stack-xxxl:80px;--med-spacing-stack-huge:120px;--med-spacing-stack-ultra:160px}:root{--med-border-radius-none:0;--med-border-radius-quark:2px;--med-border-radius-nano:4px;--med-border-radius-sm:8px;--med-border-radius-md:16px;--med-border-radius-lg:24px;--med-border-radius-pill:31.25em;--med-border-radius-full:50%;--med-border-radius-speech-left-down:8px 8px 8px 0;--med-border-radius-speech-right-down:8px 8px 0 8px;--med-border-radius-speech-right-up:8px 0 8px 0px;--med-border-radius-speech-left-up:0 8px 8px 0px;--med-border-radius-table-down-sm:0 0 8px 8px;--med-border-radius-table-up-sm:8px 8px 0 0;--med-border-radius-table-down-md:16px 16px 0 0;--med-border-radius-table-up-md:0 0 16px 16px;--med-border-width-none:0;--med-border-width-quark:0.25px;--med-border-width-nano:0.5px;--med-border-width-hairline:1px;--med-border-width-thin:2px;--med-border-width-thick:4px;--med-border-width-bold:8px;--med-border-width-heavy:16px;--med-opacity-level-semiopaque:0.8;--med-opacity-level-intense:0.64;--med-opacity-level-half:0.5;--med-opacity-level-medium:0.32;--med-opacity-level-light:0.16;--med-opacity-level-semitransparent:0.08;--med-shadow-level-0:none;--med-shadow-level-1:0 0 2px rgba(0, 0, 0, 0.12), 0 2px 2px rgba(0, 0, 0, 0.14), 0 1px 3px rgba(0, 0, 0, 0.2);--med-shadow-level-2:0 2px 4px rgba(0, 0, 0, 0.14), 0 3px 4px rgba(0, 0, 0, 0.12), 0 1px 5px rgba(0, 0, 0, 0.2);--med-shadow-level-3:0 3px 3px rgba(0, 0, 0, 0.14), 0 3px 4px rgba(0, 0, 0, 0.12), 0 1px 8px rgba(0, 0, 0, 0.2);--med-shadow-level-4:0 0 2px rgba(0, 0, 0, 0.14), 0 4px 5px rgba(0, 0, 0, 0.12), 0 1px 10px rgba(0, 0, 0, 0.2);--med-shadow-level-5:0 6px 10px rgba(0, 0, 0, 0.14), 0 1px 18px rgba(0, 0, 0, 0.12), 0 3px 5px rgba(0, 0, 0, 0.2);--med-shadow-level-6:0 8px 10px rgba(0, 0, 0, 0.14), 0 3px 14px rgba(0, 0, 0, 0.12), 0 4px 5px rgba(0, 0, 0, 0.2);--med-shadow-level-7:0 9px 12px rgba(0, 0, 0, 0.14), 0 3px 16px rgba(0, 0, 0, 0.12), 0 5px 6px rgba(0, 0, 0, 0.2);--med-shadow-level-8:0 12px 17px rgba(0, 0, 0, 0.14), 0 5px 22px rgba(0, 0, 0, 0.12), 0 7px 8px rgba(0, 0, 0, 0.2);--med-shadow-level-9:0 16px 24px rgba(0, 0, 0, 0.14), 0 6px 30px rgba(0, 0, 0, 0.12), 0 8px 10px rgba(0, 0, 0, 0.2);--med-shadow-level-10:0 24px 38px rgba(0, 0, 0, 0.14), 0 9px 46px rgba(0, 0, 0, 0.12), 0 11px 15px rgba(0, 0, 0, 0.2)}ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute !important;top:0 !important;right:0 !important;left:0 !important;-webkit-transition-duration:0ms;transition-duration:0ms;will-change:transform}';var VirtualScroll=function(){function e(e){var t=this;registerInstance(this,e);this.range={offset:0,length:0};this.viewportHeight=0;this.cells=[];this.virtualDom=[];this.isEnabled=false;this.viewportOffset=0;this.currentScrollTop=0;this.indexDirty=0;this.lastItemLen=0;this.totalHeight=0;this.approxItemHeight=45;this.approxHeaderHeight=30;this.approxFooterHeight=30;this.onScroll=function(){t.updateVirtualScroll()}}e.prototype.itemsChanged=function(){this.calcCells();this.updateVirtualScroll()};e.prototype.connectedCallback=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(i){switch(i.label){case 0:e=this.el.closest("ion-content");if(!e){console.error("<ion-virtual-scroll> must be used inside an <ion-content>");return[2]}t=this;return[4,e.getScrollElement()];case 1:t.scrollEl=i.sent();this.contentEl=e;this.calcCells();this.updateState();return[2]}}))}))};e.prototype.componentDidUpdate=function(){this.updateState()};e.prototype.disconnectedCallback=function(){this.scrollEl=undefined};e.prototype.onResize=function(){this.calcCells();this.updateVirtualScroll()};e.prototype.positionForItem=function(e){return Promise.resolve(positionForIndex(e,this.cells,this.getHeightIndex()))};e.prototype.checkRange=function(e,t){if(t===void 0){t=-1}return __awaiter(this,void 0,void 0,(function(){var i,r,n;return __generator(this,(function(s){if(!this.items){return[2]}i=t===-1?this.items.length-e:t;r=findCellIndex(this.cells,e);n=calcCells(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,r,e,i);this.cells=inplaceUpdate(this.cells,n,r);this.lastItemLen=this.items.length;this.indexDirty=Math.max(e-1,0);this.scheduleUpdate();return[2]}))}))};e.prototype.checkEnd=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(this.items){this.checkRange(this.lastItemLen)}return[2]}))}))};e.prototype.updateVirtualScroll=function(){if(!this.isEnabled||!this.scrollEl){return}if(this.timerUpdate){clearTimeout(this.timerUpdate);this.timerUpdate=undefined}readTask(this.readVS.bind(this));writeTask(this.writeVS.bind(this))};e.prototype.readVS=function(){var e=this,t=e.contentEl,i=e.scrollEl,r=e.el;var n=0;var s=r;while(s&&s!==t){n+=s.offsetTop;s=s.offsetParent}this.viewportOffset=n;if(i){this.viewportHeight=i.offsetHeight;this.currentScrollTop=i.scrollTop}};e.prototype.writeVS=function(){var e=this.indexDirty;var t=this.currentScrollTop-this.viewportOffset;var i=getViewport(t,this.viewportHeight,100);var r=this.getHeightIndex();var n=getRange(r,i,2);var s=getShouldUpdate(e,this.range,n);if(!s){return}this.range=n;updateVDom(this.virtualDom,r,this.cells,n);if(this.nodeRender){doRender(this.el,this.nodeRender,this.virtualDom,this.updateCellHeight.bind(this))}else if(this.domRender){this.domRender(this.virtualDom)}else if(this.renderItem){forceUpdate(this)}};e.prototype.updateCellHeight=function(e,t){var i=this;var r=function(){if(t["$ionCell"]===e){var r=window.getComputedStyle(t);var n=t.offsetHeight+parseFloat(r.getPropertyValue("margin-bottom"));i.setCellHeight(e,n)}};if(t){componentOnReady(t,r)}else{r()}};e.prototype.setCellHeight=function(e,t){var i=e.i;if(e!==this.cells[i]){return}if(e.height!==t||e.visible!==true){e.visible=true;e.height=t;this.indexDirty=Math.min(this.indexDirty,i);this.scheduleUpdate()}};e.prototype.scheduleUpdate=function(){var e=this;clearTimeout(this.timerUpdate);this.timerUpdate=setTimeout((function(){return e.updateVirtualScroll()}),100)};e.prototype.updateState=function(){var e=!!(this.scrollEl&&this.cells);if(e!==this.isEnabled){this.enableScrollEvents(e);if(e){this.updateVirtualScroll()}}};e.prototype.calcCells=function(){if(!this.items){return}this.lastItemLen=this.items.length;this.cells=calcCells(this.items,this.itemHeight,this.headerHeight,this.footerHeight,this.headerFn,this.footerFn,this.approxHeaderHeight,this.approxFooterHeight,this.approxItemHeight,0,0,this.lastItemLen);this.indexDirty=0};e.prototype.getHeightIndex=function(){if(this.indexDirty!==Infinity){this.calcHeightIndex(this.indexDirty)}return this.heightIndex};e.prototype.calcHeightIndex=function(e){if(e===void 0){e=0}this.heightIndex=resizeBuffer(this.heightIndex,this.cells.length);this.totalHeight=calcHeightIndex(this.heightIndex,this.cells,e);this.indexDirty=Infinity};e.prototype.enableScrollEvents=function(e){var t=this;if(this.rmEvent){this.rmEvent();this.rmEvent=undefined}var i=this.scrollEl;if(i){this.isEnabled=e;i.addEventListener("scroll",this.onScroll);this.rmEvent=function(){i.removeEventListener("scroll",t.onScroll)}}};e.prototype.renderVirtualNode=function(e){var t=e.cell,i=t.type,r=t.value,n=t.index;switch(i){case CELL_TYPE_ITEM:return this.renderItem(r,n);case CELL_TYPE_HEADER:return this.renderHeader(r,n);case CELL_TYPE_FOOTER:return this.renderFooter(r,n)}};e.prototype.render=function(){var e=this;return h(Host,{style:{height:this.totalHeight+"px"}},this.renderItem&&h(VirtualProxy,{dom:this.virtualDom},this.virtualDom.map((function(t){return e.renderVirtualNode(t)}))))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{itemHeight:["itemsChanged"],headerHeight:["itemsChanged"],footerHeight:["itemsChanged"],items:["itemsChanged"]}},enumerable:false,configurable:true});return e}();var VirtualProxy=function(e,t,i){var r=e.dom;return i.map(t,(function(e,t){var i=r[t];var n=e.vattrs||{};var s=n.class||"";s+="virtual-item ";if(!i.visible){s+="virtual-loading"}return Object.assign(Object.assign({},e),{vattrs:Object.assign(Object.assign({},n),{class:s,style:Object.assign(Object.assign({},n.style),{transform:"translate3d(0,"+i.top+"px,0)"})})})}))};VirtualScroll.style=virtualScrollCss;export{VirtualScroll as ion_virtual_scroll};